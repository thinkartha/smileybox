version: "3.8"

services:
  # ===========================================================================
  # Go Backend API (uses DynamoDB - AWS credentials required)
  # ===========================================================================
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: supporttickr-api
    ports:
      - "8080:8080"
    environment:
      JWT_SECRET: ${JWT_SECRET:-change-me-in-production-use-a-strong-secret}
      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:3000}
      PORT: "8080"
      # DynamoDB table names (defaults match SAM stack)
      USERS_TABLE: ${USERS_TABLE:-supportdesk-users}
      ORGS_TABLE: ${ORGS_TABLE:-supportdesk-organizations}
      TICKETS_TABLE: ${TICKETS_TABLE:-supportdesk-tickets}
      MESSAGES_TABLE: ${MESSAGES_TABLE:-supportdesk-messages}
      TIME_ENTRIES_TABLE: ${TIME_ENTRIES_TABLE:-supportdesk-time-entries}
      CONVERSION_REQUESTS_TABLE: ${CONVERSION_REQUESTS_TABLE:-supportdesk-conversion-requests}
      INVOICES_TABLE: ${INVOICES_TABLE:-supportdesk-invoices}
      ACTIVITIES_TABLE: ${ACTIVITIES_TABLE:-supportdesk-activities}
    restart: unless-stopped

  # ===========================================================================
  # Next.js Frontend
  # ===========================================================================
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:8080}
    container_name: supporttickr-web
    ports:
      - "3000:3000"
    environment:
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:8080}
    depends_on:
      - backend
    restart: unless-stopped
